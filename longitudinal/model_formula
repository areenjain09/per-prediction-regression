# 02_define_predictors.R

# Load data from Part 1
data_clean <- readRDS("data_clean.rds")

# Define core predictors excluding PER components
core_predictors <- c("HGT", "WGT", "FG.", "X3P.", "FT.", "RPG", "WNGSPN",
                     "STNDVERT", "SPRINT", "LPVERT", "BMI", "LANE", "POS", "sznab")

# Keep only predictors that exist
predictors_to_use <- intersect(core_predictors, colnames(data_clean))
missing_predictors <- setdiff(core_predictors, predictors_to_use)
if(length(missing_predictors) > 0){
  cat("Warning: Missing predictors will be skipped:", paste(missing_predictors, collapse = ", "), "\n")
}
cat("Final predictors:", paste(predictors_to_use, collapse = ", "), "\n")

# Build formula for beta mixed model
response_var <- "PER_beta"
formula_beta <- as.formula(
  paste(response_var, "~", paste(predictors_to_use, collapse = " + "), "+ (1 | Player)")
)

# Save formula and predictors for next script
saveRDS(list(formula_beta = formula_beta, predictors_to_use = predictors_to_use), "model_setup.rds")
